(function ($) {
    $.fn.rsLiteMenu = function (options) {
        if (!Array.prototype.indexOf) {
            Array.prototype.indexOf = function (obj, start) {
                for (var i = (start || 0); i < this.length; i++) { if (this[i] === obj) { return i; } }
                return -1;
            } 
        }
        var opts = $.extend({}, $.fn.rsLiteMenu.defaults, options), subMenuManager = { stackObjs: [], stackHidden: [], push: function (element, hidden) { this.stackObjs.push(element); this.stackHidden.push(hidden); }, pop: function () { if (this.stackObjs.length == 0) { return null; } else { this.stackHidden.pop(); return this.stackObjs.pop(); } }, setVisible: function (element) { var index = this.stackObjs.indexOf(element); if (index == -1) { this.push(element, false); opts.onShowSubmenu($(element)); } else { this.stackHidden[index] = false; } }, setHidden: function (element) { var index = this.stackObjs.indexOf(element); if (index > -1) { this.stackHidden[index] = true; if (index == this.stackObjs.length - 1) { while (index > -1 && this.stackHidden[index]) { opts.onHideSubmenu($(this.stackObjs[index--])); this.pop(); } } } }, setHiddenAll: function (element) { var index = this.stackObjs.indexOf(element); if (index > -1) { index = this.stackObjs.length - 1; while (index > -1) { opts.onHideSubmenu($(this.stackObjs[index--])); this.pop(); } } } }, showSubMenu = function ($liElement) { var $ulOlElements = $liElement.children("ul, ol"); if ($ulOlElements.length > 0) { subMenuManager.setVisible($ulOlElements[0]); } }, hideSubMenu = function ($liElement, $topLists) { var $ulOlElements = $liElement.children("ul, ol"); if ($ulOlElements.length > 0) { if (opts.hideOnlyTopSubMenus) { if ($topLists.filter($liElement.children("ul, ol")).length > 0) { subMenuManager.setHiddenAll($ulOlElements[0]); } } else { subMenuManager.setHidden($ulOlElements[0]); } } }; return this.each(function () { var $menuCtrl = $(this); $("ul, ol", $menuCtrl).hide(); $("li:has(ul,ol)", $menuCtrl).mouseenter(function () { showSubMenu($(this)); }).mouseleave(function () { hideSubMenu($(this), $menuCtrl.children("li").children("ul, ol")); }); });
    }; $.fn.rsLiteMenu.defaults = { onShowSubmenu: function (element) { element.show(); }, onHideSubmenu: function (element) { element.hide(); }, hideOnlyTopSubMenus: false };
})(jQuery);